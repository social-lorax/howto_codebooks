---
output: 
  html_document:
    highlight: tango
    toc: true
    toc_float: true
    toc_depth: 4
    number_sections: false
    df_print: kable
---

\newcommand\first[1]{\color{darkblue}{\textbf{#1}}}
\newcommand\second[1]{\color{dodgerblue}{\textbf{#1}}}
\newcommand\third[1]{\color{skyblue}{\textrm{#1}}}

```{r include=FALSE}
knitr::opts_chunk$set(comment = NA, warning=FALSE, message=FALSE)

library(tidyverse)
```

# $\first{Spatial Data}$

***

### $\second{Components}$

**Spatial Data = Coordinates + Coordinate Reference System (CRS)**

A common CRS is latitude/longitude

* Latitude = position North to South
* Longitude = position East to West

<img src="https://github.com/social-lorax/howto_codebooks/blob/master/images/spatial_latlong.jpg?raw=true" width="500">

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/spatial_latlong2.jpg?raw=true)

|Type     |Latitude  |Longitude |
|---------|----------|----------|
|Standard |44.57808N |123.2803W |
|Coding   |44.57808  |-123.2803 |
|         |+N, -S    |+E, -W    |

Often it is written as: (longitude, latitude)  

Thus: (-123.2803, 44.57808)

***

### $\second{Types}$

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/spatial_types.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/R_underline.png?raw=true)

# $\first{Spatial R}$

***

```{r}
library(sf)
```

### $\second{Reading in Data}$

```{r eval = FALSE}
spatial <- read_sf("pathway/to/shapefile.shp")
```

```{r eval = FALSE}
spatial <- read_csv("pathway/to/spatial.csv") %>% 
  st_as_sf()
```

***

### $\second{Setting CRS}$

|Name                               |Code|
|-----------------------------------|----|
|World Geodetic System 1984 (WGS 84)|4326|
|NAD83 / New York Long Island       |2263|

```{r eval = FALSE}
spatial <- read_sf("pathway/to/shapefile.shp") %>% 
  st_transform(2263)
```

***

### $\second{Removing Geometry}$

```{r eval = FALSE}
non_spatial <- spatial %>% 
  st_set_geometry(NULL)
```

***

### $\second{Plotting}$

```{r echo = FALSE, message = FALSE, results='hide'}
library(tigris)
options(tigris_class = "sf")

ny_counties <- counties(state = "NY", cb = TRUE) %>% 
  as_tibble() %>% 
  filter(NAME %in% c("Bronx", "New York", "Kings", "Queens", "Richmond")) %>% 
  st_as_sf(crs = 2263) 
```

```{r}
#ny_counties <- read_sf(dataset with county shapefiles)

borough_halls <- tibble(lon = c(-73.990540,
                                -73.923790,
                                -73.921090,
                                -74.075960,
                                -74.003740),
                        lat = c(40.692631,
                                40.826270,
                                40.743600,
                                40.642400,
                                40.713010),
                        boro = c("Brooklyn",
                                 "Bronx",
                                 "Queens",
                                 "Staten Island",
                                 "Brooklyn")) 

borough_halls_geo <- borough_halls %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2263)


ggplot() + 
  geom_sf(data = ny_counties) + 
  geom_sf(data = borough_halls_geo) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())
```

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/R_underline.png?raw=true)

# $\first{New York City}$

***

### $\second{City}$

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_ny.png?raw=true)

***

### $\second{Borough/County}$

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_borough.png?raw=true)

***

### $\second{Community District}$

* Created by the City through local law in 1975 to serve as political units

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_cds.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_cds_bx.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_cds_bk.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_cds_mn.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_cds_qn.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_cds_si.png?raw=true)

***

### $\second{Sub-Borough Area/PUMA}$

* The Census' approximation of Community Districts 
* Statistical areas defined for Public Use Microdata Sample (PUMS)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_sbas.png?raw=true)

***

### $\second{Neighborhood Tabulation Area}$

* Created by the City to project populations at a small area level (min 15,000 people) for PlaNYC
* Based on Census Tracts (meaning they line up with PUMAs and not Community Districts)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_nta.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_nta_bx.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_nta_bk.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_nta_mn.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_nta_qn.png?raw=true)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_nta_si.png?raw=true)

***

### $\second{ZIP Codes}$

* Created by USPS for the purposes of sorting and delivering mail
* Not related to neighborhoods, political districts, or demographics
* Not coterminous with census tracts, CDs, SBAs, or even boroughs
* Approximated by the Census as ZCTAs 

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_zip.png?raw=true)

***

### $\second{Borough, Block, and Lot (BBL)}$

* Created by the Department of Finance for taxes, zoning, construction, and other purposes
* Ideally one building sits on a single lot that has one owner who pays taxes on the building
* Search by property or BBL [here](https://a836-pts-access.nyc.gov/care/forms/htmlframe.aspx?mode=content/home.htm)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_bbl.png?raw=true)

***

### $\second{Building Identification Number (BIN)}$

* Created by the Department of Buildings to uniquely identify every individual building
* Process = Building permit filed with DOB > DOB creates temporary BIN (TBIN) > DOB issues a Certificate of Occupancy > DOB adds BIN to address database (PAD) > DoITT adds building footprint

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_bin.png?raw=true)

***

### $\second{PLUTO}$

* Comprehensive land use dataset and key [here](https://www1.nyc.gov/site/planning/data-maps/open-data/dwn-pluto-mappluto.page)

![](https://github.com/social-lorax/howto_codebooks/blob/master/images/maps_pluto.png?raw=true)